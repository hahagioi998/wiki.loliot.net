---
id: ddd
title: DDD(Domain-Driven Design)
sidebar_label: DDD
description: DDD(Domain-Driven Design)
keywords:
  - ddd
  - domain
---

import Image from "@theme/IdealImage";

<center>
  <Image
    img={require("@site/static/img/lang/design/DDD-Architecture.jpg")}
    width={900}
  />
</center>

:::warning
DDD를 적용하는 것이 항상 좋은것은 아닙니다.

CRUD만으로 해결되지 않는 경우, 복잡한 사용자 스토리, 잦은 변경 및 기능 추가, 팀원 모두 생소한 도메인 등 여러 조건에 따라 필요한 곳에 부분적으로 적용하는 것이 좋습니다.
:::

## Domain layer

### Domain

개발하고자 하는 구체적인 비지니스 영역(현실세계의 문제)를 도메인이라고 합니다. 도메인은 여러 개의 서브도메인으로 이뤄져 있습니다. 해당 분야에 대한 지식을 가지고 있는 전문가, 실무자 등을 도메인 전문가(Domain expert)라고 부릅니다.

### Domain model

> 모형(模型, Model, 모델)은 객체, 시스템, 또는 개념에 대한 구조나 작업을 보여주기 위한 패턴, 계획, 또는 설명이다. - Wikipedia

도메인 모델은 특정 도메인을 개념적으로 표현한 것입니다. 도메인 모델링을 하면서 도메인 전문가와 소프트웨어 개발자들 사이에서 개발되고 공유된 언어를 유비쿼터스 언어(Ubiquitous Language)라고 합니다.

#### Entity

식별자를 가지며 영속성(Persistence)이 필요한 객체입니다. 영속성은 데이터를 생성한 프로그램이 종료되더라도 데이터가 사라지지 않는 특성을 말합니다.

#### Value Object

식별자가 없으며 불변(Immutable) 객체입니다.

#### Aggregate

복잡한 연관 관계를 맺는 객체들이 생기고 이를 대상으로 변경의 일관성(Consistency)을 보장하기란 쉽지 않습니다. 이 문제를 해결하기위해 애그리거트라는 객체 집합을 사용합니다.

- 루트(Root)는 전역 ID를 갖는 엔티티입니다.
  - 불변식(Invariants)을 검사합니다.
  - 경계 내의 객체들을 변경할 수 있습니다.
  - 내부 엔티티 참조를 반환할 수 있습니다.(변경을 목적으로 하면 안됨)
  - 내부 값 객체의 복사본은 반환할 수 있습니다.
- 애그리거트 경계(Boundary) 내의 엔티티는 지역 ID를 갖습니다.
- 삭제 연산은 애그리거트의 모든 객체를 제거해야 합니다.
- 생성이 복잡한 경우 Factory를 사용합니다.
- 리포지터리(Repository)는 애그리거트만 반환하도록 설계합니다.

#### Domain Service

엔티티나 값 객체에 속하지는 않지만 이들을 조합하여 수행되어야 하는 로직들입니다.

## Application layer

### Application Service

애플리케이션 서비스의 일반적인 형태는 다음과 같습니다.

1. 리포지터리에서 엔티티 또는 애그리거트를 얻어옵니다.
1. 도메인 서비스, 애그리거트, 엔티티 등을 사용하여 도메인 로직을 수행합니다.
1. 리포지터리를 사용하여 변경사항을 저장합니다.

:::warning
애플리케이션 서비스의 시그니처에 도메인 객체가 타입으로 사용되면 이를 사용하는 외부 프로그램이 도메인에 대한 의존성을 갖게 되기 때문에 주의해야 합니다.
:::

### Port-Adapter

#### Port

포트는 수행해야 하는 작업을 추상화한 인터페이스(Interface)입니다. 단순히 도구의 API를 모방하는 것이 아니라 도메인 요구사항에 맞는 인터페이스로 구성되어야 다양한 어댑터를 붙일 수 있습니다.

#### Primary/Driving Adapter

1차 어댑터의 시그니처는 HTTP, gRPC, CLI 등 외부 요청에 맞춰 작성되어야 합니다.

#### Secondary/Driven Adapter

## Reference

- [https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/](https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/)
- Eric Evans, Domain-Driven Design: Tackling Complexity in the Heart of Software
