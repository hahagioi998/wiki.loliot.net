---
id: parallel-cluster
title: AWS ParallelCluster
sidebar_label: ParallelCluster
description: AWS ParallelCluster
keywords:
  - ParallelCluster
---

## Prerequisites

### VPC

```python
name = f"{const.CLUSTER_NAME}-vpc"
vpc = aws.ec2.Vpc(
    name,
    enable_dns_hostnames=True,
    enable_dns_support=True,
    instance_tenancy="default",
    cidr_block="172.16.0.0/16",
    tags={
        "Name": name,
    },
)
```

TODO: subnet, route

### Scripts

```python
name = f"{const.CLUSTER_NAME}-head-node-on-node-configured"
head_node_on_node_configured = aws.s3.BucketObjectv2(
    name,
    bucket=s3.bucket.id,
    key=f"parallel/{name}.sh",
    source=pulumi.FileAsset("parallel/head-node-on-node-configured.sh"),
    opts=pulumi.ResourceOptions(parent=s3.bucket),
    tags={
        "Name": name,
    },
)

name = f"{const.CLUSTER_NAME}-compute-node-on-node-configured"
compute_node_on_node_configured = aws.s3.BucketObjectv2(
    name,
    bucket=s3.bucket.id,
    key=f"parallel/{name}.sh",
    source=pulumi.FileAsset("parallel/compute-node-on-node-configured.sh"),
    opts=pulumi.ResourceOptions(parent=s3.bucket),
    tags={
        "Name": name,
    },
)

# Export

pulumi.export(
    "head_node_on_node_configured",
    pulumi.Output.all(
        bucket=head_node_on_node_configured.bucket,
        key=head_node_on_node_configured.key,
    ).apply(lambda args: f"s3://{args['bucket']}/{args['key']}"),
)
pulumi.export(
    "compute_node_on_node_configured",
    pulumi.Output.all(
        bucket=compute_node_on_node_configured.bucket,
        key=compute_node_on_node_configured.key,
    ).apply(lambda args: f"s3://{args['bucket']}/{args['key']}"),
)
```

### cluster-config.yaml

- 인스턴스 유형: https://aws.amazon.com/ko/ec2/instance-types/
- 설정: https://docs.aws.amazon.com/ko_kr/parallelcluster/latest/ug/configuration-v3.html

```yaml

```

## pcluster

```shell
export PARALLEL_CLUSTER_NAME=<cluster-name>
```

### create-cluster

```shell
pcluster configure --config cluster-config.yaml
```

대화형으로 클러스터를 생성합니다.

```shell
pcluster create-cluster \
    --cluster-name $PARALLEL_CLUSTER_NAME \
    --cluster-configuration cluster-config.yaml
```

config 파일을 사용하여 클러스터를 생성합니다.

### update-cluster

```shell
pcluster update-compute-fleet \
    --cluster-name $PARALLEL_CLUSTER_NAME \
    --status STOP_REQUESTED
```

```shell
pcluster update-cluster \
    --cluster-name $PARALLEL_CLUSTER_NAME \
    --cluster-config cluster-config.yaml
```

```shell
pcluster describe-cluster \
    --cluster-name $PARALLEL_CLUSTER_NAME \
| jq '.cloudFormationStackStatus'
```

```shell
pcluster update-compute-fleet \
    --cluster-name $PARALLEL_CLUSTER_NAME \
    --status START_REQUESTED
```

### delete-cluster

```shell
pcluster delete-cluster \
    --cluster-name $PARALLEL_CLUSTER_NAME
```

## Reference

- https://docs.aws.amazon.com/ko_kr/parallelcluster/latest/ug/install-v3-virtual-environment.html
- https://docs.aws.amazon.com/ko_kr/parallelcluster/latest/ug/network-configuration-v3.html
- https://docs.aws.amazon.com/ko_kr/parallelcluster/latest/ug/cluster-configuration-file-v3.html
