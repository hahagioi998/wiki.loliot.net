---
id: basics
title: Pulumi basics
sidebar_label: Basics
description: Pulumi basics
keywords:
  - pulumi
---

## Installation

### AWS

```shell
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

- `AWS Access Key ID and Access Key`: IAM -> 사용자 -> <user\> -> 보안 자격 증명 -> 액세스 키 만들기

```shell
aws configure --profile <profile>
```

### Pulumi

```shell
curl -fsSL https://get.pulumi.com | sh
```

```shell
pulumi login [<url>]
```

- `url`
  - `s3://<pulumi-stack-bucket>`
  - `file://<pulumi-stack-path>`

## Tutorial

```shell
mkdir test && cd test
```

```shell title="pulumi_config_passphrase"
<암호>
```

```shell
export PULUMI_CONFIG_PASSPHRASE_FILE=<path>/pulumi_config_passphrase
```

```yaml title="Pulumi.yaml"
name: <project>
runtime:
  name: python
backend:
  url: s3://pulumi_iac/<project>
template:
  config:
    aws:region:
      value: us-west-2
    aws:profile:
      value: <profile>
```

```shell
pulumi stack init test.dev
```

:::info
backend.url을 공유하는 여러 프로젝트는, stack이름으로 접근이 가능합니다.(`pulumi.StackReference`) 따라서 stack이름을 지을 때, `<sub-project>.prod` 등의 형식으로 짓는 것이 좋습니다.
:::

```python titile="__main__.py"
import pulumi
import pulumi_aws as aws

name = "app_server"
aws_instance = aws.ec2.Instance(
    name,
    ami="ami-090717c950a5c34d3",
    instance_type="t3.micro",
    tags={
        "Name": name,
    },
)

pulumi.export("instance_id", aws_instance.id)
pulumi.export("instance_public_ip", aws_instance.public_ip)
```

```shell
pulumi refresh --yes --skip-preview
```

```shell
pulumi up
```

```shell
pulumi destroy --skip-preview
```

```shell
pulumi stack rm test.dev
```

## Reference

- https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html
- https://www.pulumi.com/docs/intro/concepts/state/
